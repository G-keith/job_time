<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.job.mapper.UserInfoMapper" >
  <select id="findByPhone" resultType="com.job.entity.UserInfo">
    select * from user_info
    where phone=#{phone}
  </select>

  <select id="findByUserId" resultType="com.job.entity.UserInfo">
    select * from user_info
    where userId=#{userId}
  </select>

  <insert id="insertPhone" useGeneratedKeys="true" keyProperty="userId">
    insert into user_info (phone,UID)
    values (#{phone},#{UID})
  </insert>

  <insert id="insertCode">
    insert into code (phone,code,sendTime)
    values (#{phone},#{code},now())
  </insert>

  <select id="findCodeByPhone" resultType="java.lang.String">
    select  code,sendTime
    from code where phone=#{phone} and isUse=0 ORDER BY sendTime desc LIMIT 1
  </select>

  <update id="updateCode">
    update code
    set isUse=1
    where phone=#{phone}
  </update>

  <select id="UidIsExist" resultType="java.lang.Integer">
    select count(1 ) from user_info where UID=#{UID}
  </select>
</mapper>